'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _utils = require('./utils');

var _styles = require('./styles');

var _styles2 = _interopRequireDefault(_styles);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var MAXCOUNT = 6;

var AnimakitRotator = function (_Component) {
  _inherits(AnimakitRotator, _Component);

  function AnimakitRotator(props) {
    _classCallCheck(this, AnimakitRotator);

    var _this = _possibleConstructorReturn(this, (AnimakitRotator.__proto__ || Object.getPrototypeOf(AnimakitRotator)).call(this, props));

    _this.state = {
      animation: false,

      sidesCount: 0,
      currentSide: 0,
      prevSide: 0,

      width: 0,
      height: 0,
      winHeight: 0,
      perspective: 0,

      sideOffset: 0,
      figureAngle: 0,
      sidesAngles: [],

      turnover: 0
    };

    _this.setFigureNode = _this.setFigureNode.bind(_this);
    return _this;
  }

  _createClass(AnimakitRotator, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      this.figureNode = null;
      this.sidesNodes = [];
      this.sidesDimensions = [];

      this.is3DSupported = (0, _utils.is3DSupported)();
      this.transitionEventName = (0, _utils.transitionEventName)();

      this.listeners = this.getListeners();

      this.animationReset = false;
      this.animationResetTO = null;
      this.resizeCheckerRAF = null;

      this.onWinResize();
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      this.repaint(this.props);

      this.toggleAnimationListener(true);
    }
  }, {
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      this.repaint(nextProps);
    }
  }, {
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(nextProps, nextState) {
      var _this2 = this;

      var stateChanged = !(0, _utils.isEqual)(nextState, this.state);

      var childrenChanged = !(0, _utils.isEqual)(nextProps.children, this.props.children);

      var propsChanged = ['background', 'shadow'].some(function (name) {
        return nextProps[name] !== _this2.props[name];
      });

      return stateChanged || childrenChanged || propsChanged;
    }
  }, {
    key: 'componentWillUpdate',
    value: function componentWillUpdate() {
      this.toggleResizeChecker(false);
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      this.toggleResizeChecker(true);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      this.toggleResizeChecker(false);
      this.toggleAnimationReset(false);
      this.toggleAnimationListener(false);
      this.toggleWinResizeListener(false);
    }
  }, {
    key: 'onTransitionEnd',
    value: function onTransitionEnd() {
      if (!this.animationReset) return;

      this.setState({
        animation: false
      });
    }
  }, {
    key: 'onCheckResize',
    value: function onCheckResize() {
      this.toggleResizeChecker(false);

      this.softRepaint();

      this.toggleResizeChecker(true);
    }
  }, {
    key: 'onWinResize',
    value: function onWinResize() {
      this.setState({
        winHeight: window.innerHeight
      });
    }
  }, {
    key: 'getListeners',
    value: function getListeners() {
      return {
        onTransitionEnd: this.onTransitionEnd.bind(this),
        onCheckResize: this.onCheckResize.bind(this),
        onWinResize: this.onWinResize.bind(this)
      };
    }
  }, {
    key: 'toggleResizeChecker',
    value: function toggleResizeChecker(start) {
      if (typeof requestAnimationFrame === 'undefined') return;

      if (start) {
        this.resizeCheckerRAF = requestAnimationFrame(this.listeners.onCheckResize);
      } else if (this.resizeCheckerRAF) {
        cancelAnimationFrame(this.resizeCheckerRAF);
      }
    }
  }, {
    key: 'toggleAnimationReset',
    value: function toggleAnimationReset(add) {
      var _this3 = this;

      if (this.animationResetTO) clearTimeout(this.animationResetTO);

      if (add) {
        this.animationResetTO = setTimeout(function () {
          _this3.animationReset = true;
        }, this.props.duration);
      } else {
        this.animationReset = false;
      }
    }
  }, {
    key: 'toggleAnimationListener',
    value: function toggleAnimationListener(add) {
      var method = add ? 'addEventListener' : 'removeEventListener';
      this.figureNode[method](this.transitionEventName, this.listeners.onTransitionEnd, false);
    }
  }, {
    key: 'toggleWinResizeListener',
    value: function toggleWinResizeListener(add) {
      var method = add ? 'addEventListener' : 'removeEventListener';
      window[method]('resize', this.listeners.onWinResize, false);
    }
  }, {
    key: 'getSceneStyles',
    value: function getSceneStyles() {
      var _state = this.state,
          width = _state.width,
          height = _state.height,
          perspective = _state.perspective;


      if (!width || !height) return null;

      if (!this.is3DSupported) return _extends({}, _styles2.default.scene, { width: width, height: height });

      return _extends({}, _styles2.default.scene, { width: width, height: height, perspective: perspective });
    }
  }, {
    key: 'getContainerStyles',
    value: function getContainerStyles() {
      if (!this.is3DSupported) return null;

      var _state2 = this.state,
          width = _state2.width,
          height = _state2.height,
          sideOffset = _state2.sideOffset;


      if (!width || !height) return null;

      var transform = 'translateZ(' + sideOffset * -1 + 'px)';

      return _extends({}, _styles2.default.container, { transform: transform });
    }
  }, {
    key: 'getFigureStyles',
    value: function getFigureStyles() {
      if (!this.is3DSupported) return null;

      var _state3 = this.state,
          width = _state3.width,
          height = _state3.height,
          figureAngle = _state3.figureAngle,
          turnover = _state3.turnover,
          axis = _state3.axis,
          animation = _state3.animation;


      if (!width || !height) return null;

      var angle = figureAngle + turnover * 360;
      var transform = 'rotate' + axis + '(' + angle + 'deg)';

      if (!animation) return _extends({}, _styles2.default.figure, { transform: transform });

      var _props = this.props,
          duration = _props.duration,
          easing = _props.easing;

      var transition = 'transform ' + duration + 'ms ' + easing;

      return _extends({}, _styles2.default.figure, { transform: transform, transition: transition });
    }
  }, {
    key: 'getSideStyles',
    value: function getSideStyles(num) {
      var _state4 = this.state,
          width = _state4.width,
          height = _state4.height,
          axis = _state4.axis,
          sidesAngles = _state4.sidesAngles,
          sideOffset = _state4.sideOffset,
          currentSide = _state4.currentSide,
          animation = _state4.animation;


      if (!width || !height) return null;

      var background = this.props.background || 'transparent';
      var transform = 'rotate' + axis + '(' + sidesAngles[num] + 'deg) translateZ(' + sideOffset + 'px)';

      if (this.is3DSupported) return _extends({}, _styles2.default.side, { transform: transform, background: background });

      var opacity = num === currentSide ? 1 : 0;
      var zIndex = num === currentSide ? 2 : 1;

      if (!animation) return _extends({}, _styles2.default.side, { opacity: opacity, zIndex: zIndex, background: background });

      var _props2 = this.props,
          duration = _props2.duration,
          easing = _props2.easing;

      var transition = 'opacity ' + duration + 'ms ' + easing;

      return _extends({}, _styles2.default.side, { opacity: opacity, zIndex: zIndex, transition: transition, background: background });
    }
  }, {
    key: 'getShadowStyles',
    value: function getShadowStyles(num) {
      var _state5 = this.state,
          currentSide = _state5.currentSide,
          sidesCount = _state5.sidesCount,
          animation = _state5.animation;


      if (!sidesCount) return {};

      var opacity = num === currentSide ? 0 : 2 / sidesCount;

      if (!animation) return _extends({}, _styles2.default.sideShadow, { opacity: opacity });

      var _props3 = this.props,
          duration = _props3.duration,
          easing = _props3.easing;

      var transition = 'opacity ' + duration + 'ms ' + easing;

      return _extends({}, _styles2.default.sideShadow, { opacity: opacity, transition: transition });
    }
  }, {
    key: 'getChildVisibility',
    value: function getChildVisibility(num) {
      if (num >= MAXCOUNT) return false;

      if (!this.state.width || !this.state.height) return true;

      var _state6 = this.state,
          currentSide = _state6.currentSide,
          prevSide = _state6.prevSide,
          sidesCount = _state6.sidesCount,
          animation = _state6.animation;


      if (num === currentSide) return true;

      if (animation && (sidesCount > 4 || Math.abs(currentSide - num) > 1)) {
        if (num === prevSide) return true;

        var _getNeighbors = (0, _utils.getNeighbors)(prevSide, sidesCount - 1),
            _getNeighbors2 = _slicedToArray(_getNeighbors, 2),
            _neighbor = _getNeighbors2[0],
            _neighbor2 = _getNeighbors2[1];

        if (num === _neighbor || num === _neighbor2) return true;
      }

      var _getNeighbors3 = (0, _utils.getNeighbors)(currentSide, sidesCount - 1),
          _getNeighbors4 = _slicedToArray(_getNeighbors3, 2),
          neighbor1 = _getNeighbors4[0],
          neighbor2 = _getNeighbors4[1];

      return (num === neighbor1 || num === neighbor2) && (animation || sidesCount > 4);
    }
  }, {
    key: 'getSideNum',
    value: function getSideNum(sideKey) {
      var sideNum = sideKey;

      _react2.default.Children.forEach(this.props.children, function (child, num) {
        if (child.key === sideKey) sideNum = num;
      });

      return sideNum;
    }
  }, {
    key: 'calcDimensions',
    value: function calcDimensions() {
      var _this4 = this;

      var maxWidth = 0;
      var maxHeight = 0;

      _react2.default.Children.map(this.props.children, function (child, num) {
        var width = 0;
        var height = 0;

        if (_this4.sidesDimensions[num]) {
          width = _this4.sidesDimensions[num].width;
          height = _this4.sidesDimensions[num].height;
        }

        if (_this4.getChildVisibility(num)) {
          var node = _this4.sidesNodes[num];

          if (node) {
            var newWidth = node.offsetWidth;
            var newHeight = node.offsetHeight;

            width = Math.abs(newWidth - width) <= 1 ? width : newWidth;
            height = Math.abs(newHeight - height) <= 1 ? height : newHeight;
          }

          _this4.sidesDimensions[num] = { width: width, height: height };
        }

        if (width > maxWidth) maxWidth = width;
        if (height > maxHeight) maxHeight = height;
      });

      return [maxWidth, maxHeight];
    }
  }, {
    key: 'calcChildrenLength',
    value: function calcChildrenLength(children) {
      var length = Array.isArray(children) ? children.length : 1;

      if (length > MAXCOUNT) length = MAXCOUNT;

      return length;
    }
  }, {
    key: 'calcRotateAngle',
    value: function calcRotateAngle(num, sidesCount) {
      return 360 / sidesCount * num;
    }
  }, {
    key: 'calcSideOffset',
    value: function calcSideOffset(size, sidesCount) {
      if (!sidesCount || sidesCount < 3) return 0;

      var count = sidesCount > MAXCOUNT ? MAXCOUNT : sidesCount;

      var circleRadius = [0.289, 0.5, 0.688, 0.866];

      return size * circleRadius[count - 3];
    }
  }, {
    key: 'calcPerspective',
    value: function calcPerspective(mainDimension, sidesCount) {
      if (!sidesCount || sidesCount < 2) return null;
      if (sidesCount === 2) return this.state.winHeight;
      return mainDimension * 4;
    }
  }, {
    key: 'resetDimensionsState',
    value: function resetDimensionsState(stateChunk) {
      var width = stateChunk.width,
          height = stateChunk.height,
          perspective = stateChunk.perspective;


      if (width === this.state.width && height === this.state.height && perspective === this.state.perspective) return {};

      return stateChunk;
    }
  }, {
    key: 'resetAxisState',
    value: function resetAxisState(stateChunk) {
      var axis = stateChunk.axis;

      if (axis === this.state.axis) return {};

      return stateChunk;
    }
  }, {
    key: 'resetSidesCountState',
    value: function resetSidesCountState(stateChunk) {
      var sidesCount = stateChunk.sidesCount;

      if (sidesCount === this.state.sidesCount) return {};

      this.toggleWinResizeListener(sidesCount === 2);

      if (sidesCount < this.state.sidesCount) {
        this.sidesDimensions.splice(sidesCount - 1, 1);
      }

      return stateChunk;
    }
  }, {
    key: 'resetCurrentSideState',
    value: function resetCurrentSideState(stateChunk) {
      var currentSide = stateChunk.currentSide,
          sidesCount = stateChunk.sidesCount,
          axisSign = stateChunk.axisSign,
          figureAngle = stateChunk.figureAngle;

      var prevSide = this.state.currentSide;

      if (currentSide === prevSide) return {};

      var animation = true;
      var turnover = this.state.turnover;

      if (currentSide === 0 && prevSide === sidesCount - 1) {
        turnover += axisSign;
      }
      if (sidesCount > 2 && currentSide === sidesCount - 1 && prevSide === 0) {
        turnover -= axisSign;
      }

      return { currentSide: currentSide, prevSide: prevSide, figureAngle: figureAngle, turnover: turnover, animation: animation };
    }
  }, {
    key: 'softRepaint',
    value: function softRepaint() {
      var sidesCount = this.state.sidesCount;

      var _calcDimensions = this.calcDimensions(),
          _calcDimensions2 = _slicedToArray(_calcDimensions, 2),
          width = _calcDimensions2[0],
          height = _calcDimensions2[1];

      var mainDimension = this.state.axis === 'X' ? height : width;
      var perspective = this.calcPerspective(mainDimension, sidesCount);
      var sideOffset = this.calcSideOffset(mainDimension, sidesCount);

      var state = this.resetDimensionsState({ width: width, height: height, perspective: perspective, sideOffset: sideOffset });

      if (Object.keys(state).length) this.setState(state);
    }
  }, {
    key: 'repaint',
    value: function repaint(nextProps) {
      var _this5 = this;

      var sidesCount = this.calcChildrenLength(nextProps.children);

      var axis = nextProps.axis !== 'X' ? 'Y' : 'X';

      var _calcDimensions3 = this.calcDimensions(),
          _calcDimensions4 = _slicedToArray(_calcDimensions3, 2),
          width = _calcDimensions4[0],
          height = _calcDimensions4[1];

      var mainDimension = axis === 'X' ? height : width;
      var perspective = this.calcPerspective(mainDimension, sidesCount);
      var sideOffset = this.calcSideOffset(mainDimension, sidesCount);

      var nextSide = this.getSideNum(nextProps.side);
      var currentSide = nextSide < sidesCount ? nextSide : sidesCount - 1;

      var axisSign = axis === 'X' ? 1 : -1;
      var figureAngle = this.calcRotateAngle(currentSide, sidesCount) * axisSign;
      var sides = Array(sidesCount).fill(0);
      var sidesAngles = sides.map(function (_, num) {
        return _this5.calcRotateAngle(num, sidesCount) * -axisSign;
      });

      var state = Object.assign({}, this.resetDimensionsState({ width: width, height: height, perspective: perspective, sideOffset: sideOffset }), this.resetAxisState({ axis: axis, perspective: perspective, sideOffset: sideOffset, figureAngle: figureAngle, sidesAngles: sidesAngles }), this.resetSidesCountState({ sidesCount: sidesCount, sideOffset: sideOffset, figureAngle: figureAngle, sidesAngles: sidesAngles }), this.resetCurrentSideState({ currentSide: currentSide, sidesCount: sidesCount, axisSign: axisSign, figureAngle: figureAngle }));

      this.applyState(state);
    }
  }, {
    key: 'applyState',
    value: function applyState(state) {
      if (!Object.keys(state).length) return;

      if (state.animation) {
        this.toggleAnimationReset(false);
      }

      this.setState(state);

      if (state.animation) {
        this.toggleAnimationReset(true);
      }
    }
  }, {
    key: 'renderShadow',
    value: function renderShadow(num) {
      if (!this.props.shadow) return null;
      if (!this.is3DSupported) return null;

      return _react2.default.createElement('div', { style: this.getShadowStyles(num) });
    }
  }, {
    key: 'setFigureNode',
    value: function setFigureNode(c) {
      this.figureNode = c;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this6 = this;

      var hasBackground = this.props.background !== null;

      return _react2.default.createElement(
        'div',
        { style: this.getSceneStyles() },
        _react2.default.createElement(
          'div',
          { style: this.getContainerStyles() },
          _react2.default.createElement(
            'div',
            { style: this.getFigureStyles(), ref: this.setFigureNode },
            _react2.default.Children.map(this.props.children, function (child, num) {
              if (num >= MAXCOUNT) return null;

              return _react2.default.createElement(
                'div',
                { style: _this6.getSideStyles(num) },
                _react2.default.createElement(
                  'div',
                  {
                    style: _styles2.default.sideWrapper,
                    ref: function ref(c) {
                      _this6.sidesNodes[num] = c;
                    }
                  },
                  _this6.getChildVisibility(num) ? child : null,
                  !hasBackground && _this6.renderShadow(num)
                ),
                hasBackground && _this6.renderShadow(num)
              );
            })
          )
        )
      );
    }
  }]);

  return AnimakitRotator;
}(_react.Component);

exports.default = AnimakitRotator;


AnimakitRotator.propTypes = {
  children: _propTypes2.default.any,
  sheet: _propTypes2.default.any,
  axis: _propTypes2.default.string,
  side: _propTypes2.default.any,
  duration: _propTypes2.default.number,
  easing: _propTypes2.default.string,
  shadow: _propTypes2.default.bool,
  background: _propTypes2.default.string
};

AnimakitRotator.defaultProps = {
  axis: 'X',
  side: 0,
  duration: 1000,
  easing: 'cubic-bezier(.165,.84,.44,1)',
  shadow: false,
  background: null
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1ha2l0Um90YXRvci5lczYiXSwibmFtZXMiOlsiTUFYQ09VTlQiLCJBbmltYWtpdFJvdGF0b3IiLCJwcm9wcyIsInN0YXRlIiwiYW5pbWF0aW9uIiwic2lkZXNDb3VudCIsImN1cnJlbnRTaWRlIiwicHJldlNpZGUiLCJ3aWR0aCIsImhlaWdodCIsIndpbkhlaWdodCIsInBlcnNwZWN0aXZlIiwic2lkZU9mZnNldCIsImZpZ3VyZUFuZ2xlIiwic2lkZXNBbmdsZXMiLCJ0dXJub3ZlciIsInNldEZpZ3VyZU5vZGUiLCJiaW5kIiwiZmlndXJlTm9kZSIsInNpZGVzTm9kZXMiLCJzaWRlc0RpbWVuc2lvbnMiLCJpczNEU3VwcG9ydGVkIiwidHJhbnNpdGlvbkV2ZW50TmFtZSIsImxpc3RlbmVycyIsImdldExpc3RlbmVycyIsImFuaW1hdGlvblJlc2V0IiwiYW5pbWF0aW9uUmVzZXRUTyIsInJlc2l6ZUNoZWNrZXJSQUYiLCJvbldpblJlc2l6ZSIsInJlcGFpbnQiLCJ0b2dnbGVBbmltYXRpb25MaXN0ZW5lciIsIm5leHRQcm9wcyIsIm5leHRTdGF0ZSIsInN0YXRlQ2hhbmdlZCIsImNoaWxkcmVuQ2hhbmdlZCIsImNoaWxkcmVuIiwicHJvcHNDaGFuZ2VkIiwic29tZSIsIm5hbWUiLCJ0b2dnbGVSZXNpemVDaGVja2VyIiwidG9nZ2xlQW5pbWF0aW9uUmVzZXQiLCJ0b2dnbGVXaW5SZXNpemVMaXN0ZW5lciIsInNldFN0YXRlIiwic29mdFJlcGFpbnQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsIm9uVHJhbnNpdGlvbkVuZCIsIm9uQ2hlY2tSZXNpemUiLCJzdGFydCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwiYWRkIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImR1cmF0aW9uIiwibWV0aG9kIiwic2NlbmUiLCJ0cmFuc2Zvcm0iLCJjb250YWluZXIiLCJheGlzIiwiYW5nbGUiLCJmaWd1cmUiLCJlYXNpbmciLCJ0cmFuc2l0aW9uIiwibnVtIiwiYmFja2dyb3VuZCIsInNpZGUiLCJvcGFjaXR5IiwiekluZGV4Iiwic2lkZVNoYWRvdyIsIk1hdGgiLCJhYnMiLCJuZWlnaGJvcjEiLCJuZWlnaGJvcjIiLCJzaWRlS2V5Iiwic2lkZU51bSIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImNoaWxkIiwia2V5IiwibWF4V2lkdGgiLCJtYXhIZWlnaHQiLCJtYXAiLCJnZXRDaGlsZFZpc2liaWxpdHkiLCJub2RlIiwibmV3V2lkdGgiLCJvZmZzZXRXaWR0aCIsIm5ld0hlaWdodCIsIm9mZnNldEhlaWdodCIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsInNpemUiLCJjb3VudCIsImNpcmNsZVJhZGl1cyIsIm1haW5EaW1lbnNpb24iLCJzdGF0ZUNodW5rIiwic3BsaWNlIiwiYXhpc1NpZ24iLCJjYWxjRGltZW5zaW9ucyIsImNhbGNQZXJzcGVjdGl2ZSIsImNhbGNTaWRlT2Zmc2V0IiwicmVzZXREaW1lbnNpb25zU3RhdGUiLCJPYmplY3QiLCJrZXlzIiwiY2FsY0NoaWxkcmVuTGVuZ3RoIiwibmV4dFNpZGUiLCJnZXRTaWRlTnVtIiwiY2FsY1JvdGF0ZUFuZ2xlIiwic2lkZXMiLCJmaWxsIiwiXyIsImFzc2lnbiIsInJlc2V0QXhpc1N0YXRlIiwicmVzZXRTaWRlc0NvdW50U3RhdGUiLCJyZXNldEN1cnJlbnRTaWRlU3RhdGUiLCJhcHBseVN0YXRlIiwic2hhZG93IiwiZ2V0U2hhZG93U3R5bGVzIiwiYyIsImhhc0JhY2tncm91bmQiLCJnZXRTY2VuZVN0eWxlcyIsImdldENvbnRhaW5lclN0eWxlcyIsImdldEZpZ3VyZVN0eWxlcyIsImdldFNpZGVTdHlsZXMiLCJzaWRlV3JhcHBlciIsInJlbmRlclNoYWRvdyIsInByb3BUeXBlcyIsImFueSIsInNoZWV0Iiwic3RyaW5nIiwibnVtYmVyIiwiYm9vbCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztB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YWtpdFJvdGF0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcblxuaW1wb3J0IHsgaXNFcXVhbCwgaXMzRFN1cHBvcnRlZCwgdHJhbnNpdGlvbkV2ZW50TmFtZSwgZ2V0TmVpZ2hib3JzIH0gZnJvbSAnLi91dGlscyc7XG5cbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9zdHlsZXMnO1xuXG5jb25zdCBNQVhDT1VOVCA9IDY7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuaW1ha2l0Um90YXRvciBleHRlbmRzIENvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAgIHNpZGVzQ291bnQ6IDAsXG4gICAgICBjdXJyZW50U2lkZTogMCxcbiAgICAgIHByZXZTaWRlOiAwLFxuXG4gICAgICB3aWR0aDogMCxcbiAgICAgIGhlaWdodDogMCxcbiAgICAgIHdpbkhlaWdodDogMCxcbiAgICAgIHBlcnNwZWN0aXZlOiAwLFxuXG4gICAgICBzaWRlT2Zmc2V0OiAwLFxuICAgICAgZmlndXJlQW5nbGU6IDAsXG4gICAgICBzaWRlc0FuZ2xlczogW10sXG5cbiAgICAgIHR1cm5vdmVyOiAwLFxuICAgIH07XG5cbiAgICB0aGlzLnNldEZpZ3VyZU5vZGUgPSB0aGlzLnNldEZpZ3VyZU5vZGUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICB0aGlzLmZpZ3VyZU5vZGUgPSBudWxsO1xuICAgIHRoaXMuc2lkZXNOb2RlcyA9IFtdO1xuICAgIHRoaXMuc2lkZXNEaW1lbnNpb25zID0gW107XG5cbiAgICB0aGlzLmlzM0RTdXBwb3J0ZWQgPSBpczNEU3VwcG9ydGVkKCk7XG4gICAgdGhpcy50cmFuc2l0aW9uRXZlbnROYW1lID0gdHJhbnNpdGlvbkV2ZW50TmFtZSgpO1xuXG4gICAgdGhpcy5saXN0ZW5lcnMgPSB0aGlzLmdldExpc3RlbmVycygpO1xuXG4gICAgdGhpcy5hbmltYXRpb25SZXNldCA9IGZhbHNlO1xuICAgIHRoaXMuYW5pbWF0aW9uUmVzZXRUTyA9IG51bGw7XG4gICAgdGhpcy5yZXNpemVDaGVja2VyUkFGID0gbnVsbDtcblxuICAgIHRoaXMub25XaW5SZXNpemUoKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMucmVwYWludCh0aGlzLnByb3BzKTtcblxuICAgIHRoaXMudG9nZ2xlQW5pbWF0aW9uTGlzdGVuZXIodHJ1ZSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIHRoaXMucmVwYWludChuZXh0UHJvcHMpO1xuICB9XG5cbiAgc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5leHRQcm9wcywgbmV4dFN0YXRlKSB7XG4gICAgY29uc3Qgc3RhdGVDaGFuZ2VkID0gIWlzRXF1YWwobmV4dFN0YXRlLCB0aGlzLnN0YXRlKTtcblxuICAgIGNvbnN0IGNoaWxkcmVuQ2hhbmdlZCA9ICFpc0VxdWFsKG5leHRQcm9wcy5jaGlsZHJlbiwgdGhpcy5wcm9wcy5jaGlsZHJlbik7XG5cbiAgICBjb25zdCBwcm9wc0NoYW5nZWQgPSBbJ2JhY2tncm91bmQnLCAnc2hhZG93J10uc29tZShcbiAgICAgIG5hbWUgPT4gbmV4dFByb3BzW25hbWVdICE9PSB0aGlzLnByb3BzW25hbWVdXG4gICAgKTtcblxuICAgIHJldHVybiBzdGF0ZUNoYW5nZWQgfHwgY2hpbGRyZW5DaGFuZ2VkIHx8IHByb3BzQ2hhbmdlZDtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVcGRhdGUoKSB7XG4gICAgdGhpcy50b2dnbGVSZXNpemVDaGVja2VyKGZhbHNlKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnRvZ2dsZVJlc2l6ZUNoZWNrZXIodHJ1ZSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnRvZ2dsZVJlc2l6ZUNoZWNrZXIoZmFsc2UpO1xuICAgIHRoaXMudG9nZ2xlQW5pbWF0aW9uUmVzZXQoZmFsc2UpO1xuICAgIHRoaXMudG9nZ2xlQW5pbWF0aW9uTGlzdGVuZXIoZmFsc2UpO1xuICAgIHRoaXMudG9nZ2xlV2luUmVzaXplTGlzdGVuZXIoZmFsc2UpO1xuICB9XG5cbiAgb25UcmFuc2l0aW9uRW5kKCkge1xuICAgIGlmICghdGhpcy5hbmltYXRpb25SZXNldCkgcmV0dXJuO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBhbmltYXRpb246IGZhbHNlLFxuICAgIH0pO1xuICB9XG5cbiAgb25DaGVja1Jlc2l6ZSgpIHtcbiAgICB0aGlzLnRvZ2dsZVJlc2l6ZUNoZWNrZXIoZmFsc2UpO1xuXG4gICAgdGhpcy5zb2Z0UmVwYWludCgpO1xuXG4gICAgdGhpcy50b2dnbGVSZXNpemVDaGVja2VyKHRydWUpO1xuICB9XG5cbiAgb25XaW5SZXNpemUoKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB3aW5IZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICB9KTtcbiAgfVxuXG4gIGdldExpc3RlbmVycygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgb25UcmFuc2l0aW9uRW5kOiB0aGlzLm9uVHJhbnNpdGlvbkVuZC5iaW5kKHRoaXMpLFxuICAgICAgb25DaGVja1Jlc2l6ZTogdGhpcy5vbkNoZWNrUmVzaXplLmJpbmQodGhpcyksXG4gICAgICBvbldpblJlc2l6ZTogdGhpcy5vbldpblJlc2l6ZS5iaW5kKHRoaXMpLFxuICAgIH07XG4gIH1cblxuICB0b2dnbGVSZXNpemVDaGVja2VyKHN0YXJ0KSB7XG4gICAgaWYgKHR5cGVvZiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPT09ICd1bmRlZmluZWQnKSByZXR1cm47XG5cbiAgICBpZiAoc3RhcnQpIHtcbiAgICAgIHRoaXMucmVzaXplQ2hlY2tlclJBRiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmxpc3RlbmVycy5vbkNoZWNrUmVzaXplKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucmVzaXplQ2hlY2tlclJBRikge1xuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5yZXNpemVDaGVja2VyUkFGKTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVBbmltYXRpb25SZXNldChhZGQpIHtcbiAgICBpZiAodGhpcy5hbmltYXRpb25SZXNldFRPKSBjbGVhclRpbWVvdXQodGhpcy5hbmltYXRpb25SZXNldFRPKTtcblxuICAgIGlmIChhZGQpIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uUmVzZXRUTyA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmFuaW1hdGlvblJlc2V0ID0gdHJ1ZTtcbiAgICAgIH0sIHRoaXMucHJvcHMuZHVyYXRpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFuaW1hdGlvblJlc2V0ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlQW5pbWF0aW9uTGlzdGVuZXIoYWRkKSB7XG4gICAgY29uc3QgbWV0aG9kID0gYWRkID8gJ2FkZEV2ZW50TGlzdGVuZXInIDogJ3JlbW92ZUV2ZW50TGlzdGVuZXInO1xuICAgIHRoaXMuZmlndXJlTm9kZVttZXRob2RdKHRoaXMudHJhbnNpdGlvbkV2ZW50TmFtZSwgdGhpcy5saXN0ZW5lcnMub25UcmFuc2l0aW9uRW5kLCBmYWxzZSk7XG4gIH1cblxuICB0b2dnbGVXaW5SZXNpemVMaXN0ZW5lcihhZGQpIHtcbiAgICBjb25zdCBtZXRob2QgPSBhZGQgPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAncmVtb3ZlRXZlbnRMaXN0ZW5lcic7XG4gICAgd2luZG93W21ldGhvZF0oJ3Jlc2l6ZScsIHRoaXMubGlzdGVuZXJzLm9uV2luUmVzaXplLCBmYWxzZSk7XG4gIH1cblxuICBnZXRTY2VuZVN0eWxlcygpIHtcbiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIHBlcnNwZWN0aXZlIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgaWYgKCF3aWR0aCB8fCAhaGVpZ2h0KSByZXR1cm4gbnVsbDtcblxuICAgIGlmICghdGhpcy5pczNEU3VwcG9ydGVkKSByZXR1cm4geyAuLi5zdHlsZXMuc2NlbmUsIHdpZHRoLCBoZWlnaHQgfTtcblxuICAgIHJldHVybiB7IC4uLnN0eWxlcy5zY2VuZSwgd2lkdGgsIGhlaWdodCwgcGVyc3BlY3RpdmUgfTtcbiAgfVxuXG4gIGdldENvbnRhaW5lclN0eWxlcygpIHtcbiAgICBpZiAoIXRoaXMuaXMzRFN1cHBvcnRlZCkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIHNpZGVPZmZzZXQgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoIXdpZHRoIHx8ICFoZWlnaHQpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgdHJhbnNmb3JtID0gYHRyYW5zbGF0ZVooJHtzaWRlT2Zmc2V0ICogLTF9cHgpYDtcblxuICAgIHJldHVybiB7IC4uLnN0eWxlcy5jb250YWluZXIsIHRyYW5zZm9ybSB9O1xuICB9XG5cbiAgZ2V0RmlndXJlU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5pczNEU3VwcG9ydGVkKSByZXR1cm4gbnVsbDtcblxuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCwgZmlndXJlQW5nbGUsIHR1cm5vdmVyLCBheGlzLCBhbmltYXRpb24gfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoIXdpZHRoIHx8ICFoZWlnaHQpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgYW5nbGUgPSBmaWd1cmVBbmdsZSArICh0dXJub3ZlciAqIDM2MCk7XG4gICAgY29uc3QgdHJhbnNmb3JtID0gYHJvdGF0ZSR7YXhpc30oJHthbmdsZX1kZWcpYDtcblxuICAgIGlmICghYW5pbWF0aW9uKSByZXR1cm4geyAuLi5zdHlsZXMuZmlndXJlLCB0cmFuc2Zvcm0gfTtcblxuICAgIGNvbnN0IHsgZHVyYXRpb24sIGVhc2luZyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB0cmFuc2l0aW9uID0gYHRyYW5zZm9ybSAke2R1cmF0aW9ufW1zICR7ZWFzaW5nfWA7XG5cbiAgICByZXR1cm4geyAuLi5zdHlsZXMuZmlndXJlLCB0cmFuc2Zvcm0sIHRyYW5zaXRpb24gfTtcbiAgfVxuXG4gIGdldFNpZGVTdHlsZXMobnVtKSB7XG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBheGlzLCBzaWRlc0FuZ2xlcywgc2lkZU9mZnNldCwgY3VycmVudFNpZGUsIGFuaW1hdGlvbiB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGlmICghd2lkdGggfHwgIWhlaWdodCkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gdGhpcy5wcm9wcy5iYWNrZ3JvdW5kIHx8ICd0cmFuc3BhcmVudCc7XG4gICAgY29uc3QgdHJhbnNmb3JtID0gYHJvdGF0ZSR7YXhpc30oJHtzaWRlc0FuZ2xlc1tudW1dfWRlZykgdHJhbnNsYXRlWigke3NpZGVPZmZzZXR9cHgpYDtcblxuICAgIGlmICh0aGlzLmlzM0RTdXBwb3J0ZWQpIHJldHVybiB7IC4uLnN0eWxlcy5zaWRlLCB0cmFuc2Zvcm0sIGJhY2tncm91bmQgfTtcblxuICAgIGNvbnN0IG9wYWNpdHkgPSBudW0gPT09IGN1cnJlbnRTaWRlID8gMSA6IDA7XG4gICAgY29uc3QgekluZGV4ID0gbnVtID09PSBjdXJyZW50U2lkZSA/IDIgOiAxO1xuXG4gICAgaWYgKCFhbmltYXRpb24pIHJldHVybiB7IC4uLnN0eWxlcy5zaWRlLCBvcGFjaXR5LCB6SW5kZXgsIGJhY2tncm91bmQgfTtcblxuICAgIGNvbnN0IHsgZHVyYXRpb24sIGVhc2luZyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB0cmFuc2l0aW9uID0gYG9wYWNpdHkgJHtkdXJhdGlvbn1tcyAke2Vhc2luZ31gO1xuXG4gICAgcmV0dXJuIHsgLi4uc3R5bGVzLnNpZGUsIG9wYWNpdHksIHpJbmRleCwgdHJhbnNpdGlvbiwgYmFja2dyb3VuZCB9O1xuICB9XG5cbiAgZ2V0U2hhZG93U3R5bGVzKG51bSkge1xuICAgIGNvbnN0IHsgY3VycmVudFNpZGUsIHNpZGVzQ291bnQsIGFuaW1hdGlvbiB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGlmICghc2lkZXNDb3VudCkgcmV0dXJuIHt9O1xuXG4gICAgY29uc3Qgb3BhY2l0eSA9IG51bSA9PT0gY3VycmVudFNpZGUgPyAwIDogMiAvIHNpZGVzQ291bnQ7XG5cbiAgICBpZiAoIWFuaW1hdGlvbikgcmV0dXJuIHsgLi4uc3R5bGVzLnNpZGVTaGFkb3csIG9wYWNpdHkgfTtcblxuICAgIGNvbnN0IHsgZHVyYXRpb24sIGVhc2luZyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB0cmFuc2l0aW9uID0gYG9wYWNpdHkgJHtkdXJhdGlvbn1tcyAke2Vhc2luZ31gO1xuXG4gICAgcmV0dXJuIHsgLi4uc3R5bGVzLnNpZGVTaGFkb3csIG9wYWNpdHksIHRyYW5zaXRpb24gfTtcbiAgfVxuXG4gIGdldENoaWxkVmlzaWJpbGl0eShudW0pIHtcbiAgICBpZiAobnVtID49IE1BWENPVU5UKSByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAoIXRoaXMuc3RhdGUud2lkdGggfHwgIXRoaXMuc3RhdGUuaGVpZ2h0KSByZXR1cm4gdHJ1ZTtcblxuICAgIGNvbnN0IHsgY3VycmVudFNpZGUsIHByZXZTaWRlLCBzaWRlc0NvdW50LCBhbmltYXRpb24gfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAobnVtID09PSBjdXJyZW50U2lkZSkgcmV0dXJuIHRydWU7XG5cbiAgICBpZiAoYW5pbWF0aW9uICYmIChzaWRlc0NvdW50ID4gNCB8fCBNYXRoLmFicyhjdXJyZW50U2lkZSAtIG51bSkgPiAxKSkge1xuICAgICAgaWYgKG51bSA9PT0gcHJldlNpZGUpIHJldHVybiB0cnVlO1xuXG4gICAgICBjb25zdCBbbmVpZ2hib3IxLCBuZWlnaGJvcjJdID0gZ2V0TmVpZ2hib3JzKHByZXZTaWRlLCBzaWRlc0NvdW50IC0gMSk7XG5cbiAgICAgIGlmIChudW0gPT09IG5laWdoYm9yMSB8fCBudW0gPT09IG5laWdoYm9yMikgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgW25laWdoYm9yMSwgbmVpZ2hib3IyXSA9IGdldE5laWdoYm9ycyhjdXJyZW50U2lkZSwgc2lkZXNDb3VudCAtIDEpO1xuXG4gICAgcmV0dXJuIChudW0gPT09IG5laWdoYm9yMSB8fCBudW0gPT09IG5laWdoYm9yMikgJiYgKGFuaW1hdGlvbiB8fCBzaWRlc0NvdW50ID4gNCk7XG4gIH1cblxuICBnZXRTaWRlTnVtKHNpZGVLZXkpIHtcbiAgICBsZXQgc2lkZU51bSA9IHNpZGVLZXk7XG5cbiAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKHRoaXMucHJvcHMuY2hpbGRyZW4sIChjaGlsZCwgbnVtKSA9PiB7XG4gICAgICBpZiAoY2hpbGQua2V5ID09PSBzaWRlS2V5KSBzaWRlTnVtID0gbnVtO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNpZGVOdW07XG4gIH1cblxuICBjYWxjRGltZW5zaW9ucygpIHtcbiAgICBsZXQgbWF4V2lkdGggPSAwO1xuICAgIGxldCBtYXhIZWlnaHQgPSAwO1xuXG4gICAgUmVhY3QuQ2hpbGRyZW4ubWFwKHRoaXMucHJvcHMuY2hpbGRyZW4sIChjaGlsZCwgbnVtKSA9PiB7XG4gICAgICBsZXQgd2lkdGggPSAwO1xuICAgICAgbGV0IGhlaWdodCA9IDA7XG5cbiAgICAgIGlmICh0aGlzLnNpZGVzRGltZW5zaW9uc1tudW1dKSB7XG4gICAgICAgIHdpZHRoID0gdGhpcy5zaWRlc0RpbWVuc2lvbnNbbnVtXS53aWR0aDtcbiAgICAgICAgaGVpZ2h0ID0gdGhpcy5zaWRlc0RpbWVuc2lvbnNbbnVtXS5oZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmdldENoaWxkVmlzaWJpbGl0eShudW0pKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLnNpZGVzTm9kZXNbbnVtXTtcblxuICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgIGNvbnN0IG5ld1dpZHRoID0gbm9kZS5vZmZzZXRXaWR0aDtcbiAgICAgICAgICBjb25zdCBuZXdIZWlnaHQgPSBub2RlLm9mZnNldEhlaWdodDtcblxuICAgICAgICAgIHdpZHRoID0gKE1hdGguYWJzKG5ld1dpZHRoIC0gd2lkdGgpIDw9IDEpID8gd2lkdGggOiBuZXdXaWR0aDtcbiAgICAgICAgICBoZWlnaHQgPSAoTWF0aC5hYnMobmV3SGVpZ2h0IC0gaGVpZ2h0KSA8PSAxKSA/IGhlaWdodCA6IG5ld0hlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2lkZXNEaW1lbnNpb25zW251bV0gPSB7IHdpZHRoLCBoZWlnaHQgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdpZHRoID4gbWF4V2lkdGgpIG1heFdpZHRoID0gd2lkdGg7XG4gICAgICBpZiAoaGVpZ2h0ID4gbWF4SGVpZ2h0KSBtYXhIZWlnaHQgPSBoZWlnaHQ7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gW21heFdpZHRoLCBtYXhIZWlnaHRdO1xuICB9XG5cbiAgY2FsY0NoaWxkcmVuTGVuZ3RoKGNoaWxkcmVuKSB7XG4gICAgbGV0IGxlbmd0aCA9IEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pID8gY2hpbGRyZW4ubGVuZ3RoIDogMTtcblxuICAgIGlmIChsZW5ndGggPiBNQVhDT1VOVCkgbGVuZ3RoID0gTUFYQ09VTlQ7XG5cbiAgICByZXR1cm4gbGVuZ3RoO1xuICB9XG5cbiAgY2FsY1JvdGF0ZUFuZ2xlKG51bSwgc2lkZXNDb3VudCkge1xuICAgIHJldHVybiAoMzYwIC8gc2lkZXNDb3VudCkgKiBudW07XG4gIH1cblxuICBjYWxjU2lkZU9mZnNldChzaXplLCBzaWRlc0NvdW50KSB7XG4gICAgaWYgKCFzaWRlc0NvdW50IHx8IHNpZGVzQ291bnQgPCAzKSByZXR1cm4gMDtcblxuICAgIGNvbnN0IGNvdW50ID0gc2lkZXNDb3VudCA+IE1BWENPVU5UID8gTUFYQ09VTlQgOiBzaWRlc0NvdW50O1xuXG4gICAgY29uc3QgY2lyY2xlUmFkaXVzID0gWzAuMjg5LCAwLjUsIDAuNjg4LCAwLjg2Nl07XG5cbiAgICByZXR1cm4gc2l6ZSAqIGNpcmNsZVJhZGl1c1tjb3VudCAtIDNdO1xuICB9XG5cbiAgY2FsY1BlcnNwZWN0aXZlKG1haW5EaW1lbnNpb24sIHNpZGVzQ291bnQpIHtcbiAgICBpZiAoIXNpZGVzQ291bnQgfHwgc2lkZXNDb3VudCA8IDIpIHJldHVybiBudWxsO1xuICAgIGlmIChzaWRlc0NvdW50ID09PSAyKSByZXR1cm4gdGhpcy5zdGF0ZS53aW5IZWlnaHQ7XG4gICAgcmV0dXJuIG1haW5EaW1lbnNpb24gKiA0O1xuICB9XG5cbiAgcmVzZXREaW1lbnNpb25zU3RhdGUoc3RhdGVDaHVuaykge1xuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCwgcGVyc3BlY3RpdmUgfSA9IHN0YXRlQ2h1bms7XG5cbiAgICBpZiAoXG4gICAgICB3aWR0aCA9PT0gdGhpcy5zdGF0ZS53aWR0aCAmJlxuICAgICAgaGVpZ2h0ID09PSB0aGlzLnN0YXRlLmhlaWdodCAmJlxuICAgICAgcGVyc3BlY3RpdmUgPT09IHRoaXMuc3RhdGUucGVyc3BlY3RpdmVcbiAgICApIHJldHVybiB7fTtcblxuICAgIHJldHVybiBzdGF0ZUNodW5rO1xuICB9XG5cbiAgcmVzZXRBeGlzU3RhdGUoc3RhdGVDaHVuaykge1xuICAgIGNvbnN0IGF4aXMgPSBzdGF0ZUNodW5rLmF4aXM7XG5cbiAgICBpZiAoYXhpcyA9PT0gdGhpcy5zdGF0ZS5heGlzKSByZXR1cm4ge307XG5cbiAgICByZXR1cm4gc3RhdGVDaHVuaztcbiAgfVxuXG4gIHJlc2V0U2lkZXNDb3VudFN0YXRlKHN0YXRlQ2h1bmspIHtcbiAgICBjb25zdCBzaWRlc0NvdW50ID0gc3RhdGVDaHVuay5zaWRlc0NvdW50O1xuXG4gICAgaWYgKHNpZGVzQ291bnQgPT09IHRoaXMuc3RhdGUuc2lkZXNDb3VudCkgcmV0dXJuIHt9O1xuXG4gICAgdGhpcy50b2dnbGVXaW5SZXNpemVMaXN0ZW5lcihzaWRlc0NvdW50ID09PSAyKTtcblxuICAgIGlmIChzaWRlc0NvdW50IDwgdGhpcy5zdGF0ZS5zaWRlc0NvdW50KSB7XG4gICAgICB0aGlzLnNpZGVzRGltZW5zaW9ucy5zcGxpY2Uoc2lkZXNDb3VudCAtIDEsIDEpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZUNodW5rO1xuICB9XG5cbiAgcmVzZXRDdXJyZW50U2lkZVN0YXRlKHN0YXRlQ2h1bmspIHtcbiAgICBjb25zdCB7IGN1cnJlbnRTaWRlLCBzaWRlc0NvdW50LCBheGlzU2lnbiwgZmlndXJlQW5nbGUgfSA9IHN0YXRlQ2h1bms7XG4gICAgY29uc3QgcHJldlNpZGUgPSB0aGlzLnN0YXRlLmN1cnJlbnRTaWRlO1xuXG4gICAgaWYgKGN1cnJlbnRTaWRlID09PSBwcmV2U2lkZSkgcmV0dXJuIHt9O1xuXG4gICAgY29uc3QgYW5pbWF0aW9uID0gdHJ1ZTtcbiAgICBsZXQgdHVybm92ZXIgPSB0aGlzLnN0YXRlLnR1cm5vdmVyO1xuXG4gICAgaWYgKGN1cnJlbnRTaWRlID09PSAwICYmIHByZXZTaWRlID09PSBzaWRlc0NvdW50IC0gMSkge1xuICAgICAgdHVybm92ZXIgKz0gYXhpc1NpZ247XG4gICAgfVxuICAgIGlmIChzaWRlc0NvdW50ID4gMiAmJiBjdXJyZW50U2lkZSA9PT0gc2lkZXNDb3VudCAtIDEgJiYgcHJldlNpZGUgPT09IDApIHtcbiAgICAgIHR1cm5vdmVyIC09IGF4aXNTaWduO1xuICAgIH1cblxuICAgIHJldHVybiB7IGN1cnJlbnRTaWRlLCBwcmV2U2lkZSwgZmlndXJlQW5nbGUsIHR1cm5vdmVyLCBhbmltYXRpb24gfTtcbiAgfVxuXG4gIHNvZnRSZXBhaW50KCkge1xuICAgIGNvbnN0IHNpZGVzQ291bnQgPSB0aGlzLnN0YXRlLnNpZGVzQ291bnQ7XG5cbiAgICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSB0aGlzLmNhbGNEaW1lbnNpb25zKCk7XG4gICAgY29uc3QgbWFpbkRpbWVuc2lvbiA9IHRoaXMuc3RhdGUuYXhpcyA9PT0gJ1gnID8gaGVpZ2h0IDogd2lkdGg7XG4gICAgY29uc3QgcGVyc3BlY3RpdmUgPSB0aGlzLmNhbGNQZXJzcGVjdGl2ZShtYWluRGltZW5zaW9uLCBzaWRlc0NvdW50KTtcbiAgICBjb25zdCBzaWRlT2Zmc2V0ID0gdGhpcy5jYWxjU2lkZU9mZnNldChtYWluRGltZW5zaW9uLCBzaWRlc0NvdW50KTtcblxuICAgIGNvbnN0IHN0YXRlID0gdGhpcy5yZXNldERpbWVuc2lvbnNTdGF0ZSh7IHdpZHRoLCBoZWlnaHQsIHBlcnNwZWN0aXZlLCBzaWRlT2Zmc2V0IH0pO1xuXG4gICAgaWYgKE9iamVjdC5rZXlzKHN0YXRlKS5sZW5ndGgpIHRoaXMuc2V0U3RhdGUoc3RhdGUpO1xuICB9XG5cbiAgcmVwYWludChuZXh0UHJvcHMpIHtcbiAgICBjb25zdCBzaWRlc0NvdW50ID0gdGhpcy5jYWxjQ2hpbGRyZW5MZW5ndGgobmV4dFByb3BzLmNoaWxkcmVuKTtcblxuICAgIGNvbnN0IGF4aXMgPSBuZXh0UHJvcHMuYXhpcyAhPT0gJ1gnID8gJ1knIDogJ1gnO1xuICAgIGNvbnN0IFt3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuY2FsY0RpbWVuc2lvbnMoKTtcbiAgICBjb25zdCBtYWluRGltZW5zaW9uID0gYXhpcyA9PT0gJ1gnID8gaGVpZ2h0IDogd2lkdGg7XG4gICAgY29uc3QgcGVyc3BlY3RpdmUgPSB0aGlzLmNhbGNQZXJzcGVjdGl2ZShtYWluRGltZW5zaW9uLCBzaWRlc0NvdW50KTtcbiAgICBjb25zdCBzaWRlT2Zmc2V0ID0gdGhpcy5jYWxjU2lkZU9mZnNldChtYWluRGltZW5zaW9uLCBzaWRlc0NvdW50KTtcblxuICAgIGNvbnN0IG5leHRTaWRlID0gdGhpcy5nZXRTaWRlTnVtKG5leHRQcm9wcy5zaWRlKTtcbiAgICBjb25zdCBjdXJyZW50U2lkZSA9IG5leHRTaWRlIDwgc2lkZXNDb3VudCA/IG5leHRTaWRlIDogc2lkZXNDb3VudCAtIDE7XG5cbiAgICBjb25zdCBheGlzU2lnbiA9IGF4aXMgPT09ICdYJyA/IDEgOiAtMTtcbiAgICBjb25zdCBmaWd1cmVBbmdsZSA9IHRoaXMuY2FsY1JvdGF0ZUFuZ2xlKGN1cnJlbnRTaWRlLCBzaWRlc0NvdW50KSAqIGF4aXNTaWduO1xuICAgIGNvbnN0IHNpZGVzID0gQXJyYXkoc2lkZXNDb3VudCkuZmlsbCgwKTtcbiAgICBjb25zdCBzaWRlc0FuZ2xlcyA9IHNpZGVzLm1hcCgoXywgbnVtKSA9PiAodGhpcy5jYWxjUm90YXRlQW5nbGUobnVtLCBzaWRlc0NvdW50KSAqIC1heGlzU2lnbikpO1xuXG4gICAgY29uc3Qgc3RhdGUgPSBPYmplY3QuYXNzaWduKFxuICAgICAge30sXG4gICAgICB0aGlzLnJlc2V0RGltZW5zaW9uc1N0YXRlKHsgd2lkdGgsIGhlaWdodCwgcGVyc3BlY3RpdmUsIHNpZGVPZmZzZXQgfSksXG4gICAgICB0aGlzLnJlc2V0QXhpc1N0YXRlKHsgYXhpcywgcGVyc3BlY3RpdmUsIHNpZGVPZmZzZXQsIGZpZ3VyZUFuZ2xlLCBzaWRlc0FuZ2xlcyB9KSxcbiAgICAgIHRoaXMucmVzZXRTaWRlc0NvdW50U3RhdGUoeyBzaWRlc0NvdW50LCBzaWRlT2Zmc2V0LCBmaWd1cmVBbmdsZSwgc2lkZXNBbmdsZXMgfSksXG4gICAgICB0aGlzLnJlc2V0Q3VycmVudFNpZGVTdGF0ZSh7IGN1cnJlbnRTaWRlLCBzaWRlc0NvdW50LCBheGlzU2lnbiwgZmlndXJlQW5nbGUgfSlcbiAgICApO1xuXG4gICAgdGhpcy5hcHBseVN0YXRlKHN0YXRlKTtcbiAgfVxuXG4gIGFwcGx5U3RhdGUoc3RhdGUpIHtcbiAgICBpZiAoIU9iamVjdC5rZXlzKHN0YXRlKS5sZW5ndGgpIHJldHVybjtcblxuICAgIGlmIChzdGF0ZS5hbmltYXRpb24pIHtcbiAgICAgIHRoaXMudG9nZ2xlQW5pbWF0aW9uUmVzZXQoZmFsc2UpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUpO1xuXG4gICAgaWYgKHN0YXRlLmFuaW1hdGlvbikge1xuICAgICAgdGhpcy50b2dnbGVBbmltYXRpb25SZXNldCh0cnVlKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJTaGFkb3cobnVtKSB7XG4gICAgaWYgKCF0aGlzLnByb3BzLnNoYWRvdykgcmV0dXJuIG51bGw7XG4gICAgaWYgKCF0aGlzLmlzM0RTdXBwb3J0ZWQpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgc3R5bGU9eyB0aGlzLmdldFNoYWRvd1N0eWxlcyhudW0pIH0gLz5cbiAgICApO1xuICB9XG5cbiAgc2V0RmlndXJlTm9kZShjKSB7XG4gICAgdGhpcy5maWd1cmVOb2RlID0gYztcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBoYXNCYWNrZ3JvdW5kID0gdGhpcy5wcm9wcy5iYWNrZ3JvdW5kICE9PSBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgc3R5bGU9eyB0aGlzLmdldFNjZW5lU3R5bGVzKCkgfT5cbiAgICAgICAgPGRpdiBzdHlsZT17IHRoaXMuZ2V0Q29udGFpbmVyU3R5bGVzKCkgfT5cbiAgICAgICAgICA8ZGl2IHN0eWxlPXsgdGhpcy5nZXRGaWd1cmVTdHlsZXMoKSB9IHJlZj17IHRoaXMuc2V0RmlndXJlTm9kZSB9PlxuICAgICAgICAgICAgeyBSZWFjdC5DaGlsZHJlbi5tYXAodGhpcy5wcm9wcy5jaGlsZHJlbiwgKGNoaWxkLCBudW0pID0+IHtcbiAgICAgICAgICAgICAgaWYgKG51bSA+PSBNQVhDT1VOVCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXsgdGhpcy5nZXRTaWRlU3R5bGVzKG51bSkgfT5cbiAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9eyBzdHlsZXMuc2lkZVdyYXBwZXIgfVxuICAgICAgICAgICAgICAgICAgICByZWY9eyAoYykgPT4geyB0aGlzLnNpZGVzTm9kZXNbbnVtXSA9IGM7IH0gfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMuZ2V0Q2hpbGRWaXNpYmlsaXR5KG51bSkgPyBjaGlsZCA6IG51bGwgfVxuICAgICAgICAgICAgICAgICAgICB7ICFoYXNCYWNrZ3JvdW5kICYmIHRoaXMucmVuZGVyU2hhZG93KG51bSkgfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICB7IGhhc0JhY2tncm91bmQgJiYgdGhpcy5yZW5kZXJTaGFkb3cobnVtKSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KSB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5BbmltYWtpdFJvdGF0b3IucHJvcFR5cGVzID0ge1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLmFueSxcbiAgc2hlZXQ6IFByb3BUeXBlcy5hbnksXG4gIGF4aXM6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHNpZGU6IFByb3BUeXBlcy5hbnksXG4gIGR1cmF0aW9uOiBQcm9wVHlwZXMubnVtYmVyLFxuICBlYXNpbmc6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHNoYWRvdzogUHJvcFR5cGVzLmJvb2wsXG4gIGJhY2tncm91bmQ6IFByb3BUeXBlcy5zdHJpbmcsXG59O1xuXG5BbmltYWtpdFJvdGF0b3IuZGVmYXVsdFByb3BzID0ge1xuICBheGlzOiAnWCcsXG4gIHNpZGU6IDAsXG4gIGR1cmF0aW9uOiAxMDAwLFxuICBlYXNpbmc6ICdjdWJpYy1iZXppZXIoLjE2NSwuODQsLjQ0LDEpJyxcbiAgc2hhZG93OiBmYWxzZSxcbiAgYmFja2dyb3VuZDogbnVsbCxcbn07XG4iXX0=